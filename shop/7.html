<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Ключ GDH</title>
  <link rel="stylesheet" href="/_s.css">
</head>
<body>
<script src="/_h.js"></script>
<div class="_wrap">
  <div class="panel section product">
    <div>
      <img src="/shop/7.avif" alt="Ключ GDH">
    </div>
    <div class="form-grid">
      <div>
        <h1 class="page-title">Ключ GDH</h1>
        <p class="lede">Доступ к GDH с мгновенной выдачей на указанную почту. Современное оформление и быстрый чек-аут.</p>
        <div class="price-pill">$4.99 · электронная доставка</div>
      </div>

      <form class="form-grid" onsubmit="pay();return false;">
        <div>
          <div class="label">Email для получения ключа</div>
          <input id="email" class="input" type="email" autocomplete="email" placeholder="you@example.com" required>
        </div>

        <div class="quantity">
          <div class="label">Количество</div>
          <div class="qty-controls">
            <input id="qty" class="number" type="number" min="1" max="10" value="1">
            <input id="qtyRange" class="range" type="range" min="1" max="10" value="1">
            <div class="total" id="total">$4.99</div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn">Оплатить</button>
          <button type="button" class="btn secondary" onclick="location.href='/donate'">Вернуться к донату</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
const price = 4.99;
const qtyInput = document.getElementById('qty');
const qtyRange = document.getElementById('qtyRange');
const totalEl = document.getElementById('total');

function sync(value){
  const qty = Math.min(10, Math.max(1, parseInt(value || '1', 10)));
  qtyInput.value = qty;
  qtyRange.value = qty;
  totalEl.textContent = `$${(price * qty).toFixed(2)}`;
  return qty;
}

qtyInput.addEventListener('input', e => sync(e.target.value));
qtyRange.addEventListener('input', e => sync(e.target.value));

function pay(){
  const email = document.getElementById('email').value.trim();
  if(!email) return alert('Введите email');
  const qty = sync(qtyInput.value);
  const resPromise = fetch('/api/np', {
    method:'POST',
    headers:{'Content-Type':'application/json'},
    body:JSON.stringify({amount:+(price*qty).toFixed(2), desc:`7x${qty} ${email}`})
  });
  resPromise.then(async r => { location = await r.text(); });
}
</script>

<script src="/_f.js"></script>
</body>
</html>
