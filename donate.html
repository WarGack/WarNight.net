<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Донат на сервер mc.WarNight.net</title>
  <link rel="stylesheet" href="/_s.css">
</head>
<body>
<script src="/_h.js"></script>
<div class="_wrap">
  <div class="panel section">
    <h1 class="page-title">Донат на mc.WarNight.net</h1>
    <p class="lede">Простое меню доната в белой теме: выбери привилегию, укажи ник и оплатите мгновенно.</p>
  </div>

  <div class="panel section">
    <h3>Данные для оплаты</h3>
    <form class="form-grid" onsubmit="pay();return false;">
      <div>
        <div class="label">Выбор привилегии</div>
        <select id="rank" class="select">
          <option value="1" data-price="2.99" data-label="VIP">VIP — $2.99</option>
          <option value="2" data-price="4.99" data-label="Lord">Lord — $4.99</option>
          <option value="3" data-price="9.99" data-label="Lord+">Lord+ — $9.99</option>
          <option value="4" data-price="29.99" data-label="Владелец">Владелец — $29.99</option>
          <option value="5" data-price="49.99" data-label="WarNight">WarNight — $49.99</option>
        </select>
      </div>
      <div>
        <div class="label">Minecraft никнейм</div>
        <input id="nick" class="input" autocomplete="nickname" placeholder="Никнейм" required>
      </div>
      <div class="form-actions">
        <div class="price-pill">К оплате: <span id="pay-total">$2.99</span></div>
        <button type="submit" class="btn">Оплатить</button>
      </div>
      <div class="copy-row">
        <div class="label">mc.WarNight.net · онлайн 24/7</div>
        <button type="button" class="copy-pill" id="server-ip" data-ip="mc.WarNight.net">
          mc.WarNight.net
          <span class="copy-pill__tip">Скопировать IP сервера в буфер обмена</span>
        </button>
      </div>
    </form>
  </div>

  <div class="panel section">
    <h3>Дополнительные товары</h3>
    <div class="goods">
      <a href="/shop/6" class="card">
        <img src="/shop/6.avif" alt="Ключ Mega Hack v9">
        <div class="card__body">
          <div class="card__price">$7.99</div>
          <div class="card__title">Ключ Mega Hack v9</div>
        </div>
      </a>
      <a href="/shop/7" class="card">
        <img src="/shop/7.avif" alt="Ключ GDH">
        <div class="card__body">
          <div class="card__price">$4.99</div>
          <div class="card__title">Ключ GDH</div>
        </div>
      </a>
    </div>
  </div>
</div>

<script>
const select = document.getElementById('rank');
const totalEl = document.getElementById('pay-total');

function syncPrice(){
  const opt = select.options[select.selectedIndex];
  totalEl.textContent = `$${(+opt.dataset.price).toFixed(2)}`;
  return opt;
}

select.addEventListener('change', syncPrice);
syncPrice();

function pay(){
  const nick = document.getElementById('nick').value.trim();
  if(!nick) return alert('Введите ник');
  const chosen = syncPrice();
  const resPromise = fetch('/api/np', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ amount: +chosen.dataset.price, desc: `${chosen.value} ${nick}` })
  });
  resPromise.then(async r => { location = await r.text(); });
}

const ipButton = document.getElementById('server-ip');
if(ipButton){
  const tip = ipButton.querySelector('.copy-pill__tip');
  const defaultTip = tip ? tip.textContent : '';
  ipButton.addEventListener('click', async () => {
    const ip = ipButton.dataset.ip;
    try {
      await navigator.clipboard.writeText(ip);
      if(tip){
        tip.textContent = 'Скопировано!';
        setTimeout(() => tip.textContent = defaultTip, 2000);
      }
    } catch (e) {
      alert('Не удалось скопировать IP');
    }
  });
}
</script>

<script src="/_f.js"></script>
</body>
</html>
